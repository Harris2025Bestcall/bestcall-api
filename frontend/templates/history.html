<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Review History - BestCall AI</title>
</head>
<body>
  <h1>Client Review History</h1>
  <div id="history">Loading...</div>

  <script>
    async function fetchHistory() {
      const token = localStorage.getItem("access_token");
      if (!token) {
        alert("Not authenticated");
        window.location.href = "/client/login";
        return;
      }

      try {
        const res = await fetch("/history", {
          method: "GET",
          headers: {
            Authorization: "Bearer " + token
          }
        });

        if (!res.ok) throw new Error("Failed to load history");

        const data = await res.json();
        if (data.length === 0) {
          document.getElementById("history").innerHTML = "<p>No history found.</p>";
          return;
        }

        let html = "<ul>";
        for (const item of data) {
          html += `
            <li style="margin-bottom: 12px;">
              <strong>Client:</strong> ${item.client_id}<br />
              <strong>Time:</strong> ${item.timestamp}<br />
              <strong>Vehicle Match:</strong> ${JSON.stringify(item.vehicle_match)}<br />
              <strong>GPT:</strong> ${JSON.stringify(item.gpt_prediction)}<br />
              <strong>ML:</strong> ${JSON.stringify(item.ml_prediction)}<br />
              <a href="/client/results?client_id=${item.client_id}">View Full Results</a>
            </li>
          `;
        }
        html += "</ul>";
        document.getElementById("history").innerHTML = html;

      } catch (err) {
        document.getElementById("history").innerText = err.message;
      }
    }

    fetchHistory();
  </script>
</body>
</html>
