<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Start Review - BestCall AI</title>
</head>
<body>
  <h1>Start a New Client Review</h1>

  <form id="uploadForm" onsubmit="submitForm(event)">
    <label>Credit Application (PDF):</label><br />
    <input type="file" id="credit_app" accept="application/pdf" required /><br /><br />

    <label>Credit Report (PDF):</label><br />
    <input type="file" id="credit_report" accept="application/pdf" required /><br /><br />

    <button type="submit">Upload & Predict</button>
  </form>

  <div id="result" style="margin-top: 20px;"></div>

  <script>
    async function submitForm(event) {
      event.preventDefault();
      const token = localStorage.getItem("access_token");
      if (!token) {
        alert("Not authenticated");
        window.location.href = "/client/login";
        return;
      }

      const formData = new FormData();
      formData.append("credit_app", document.getElementById("credit_app").files[0]);
      formData.append("credit_report", document.getElementById("credit_report").files[0]);

      try {
        const res = await fetch("/upload/", {
          method: "POST",
          body: formData,
          headers: {
            Authorization: "Bearer " + token
          }
        });

        if (!res.ok) throw new Error("Upload failed");
        const data = await res.json();

        document.getElementById("result").innerHTML = `
          <h3>Prediction Results</h3>
          <p><strong>Client ID:</strong> ${data.client_id}</p>
          <p><strong>GPT Prediction:</strong> ${JSON.stringify(data.gpt_prediction)}</p>
          <p><strong>ML Prediction:</strong> ${JSON.stringify(data.ml_prediction)}</p>
          <p><strong>Vehicle Match:</strong> ${JSON.stringify(data.vehicle_match)}</p>
          <a href="/client/results?client_id=${data.client_id}">üîç View Detailed Results</a>
        `;
      } catch (err) {
        document.getElementById("result").innerText = err.message;
      }
    }
  </script>
</body>
</html>
