<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory - BestCall AI</title>
</head>
<body>
  <h1>Dealership Inventory</h1>

  <input type="text" id="search" placeholder="Search inventory..." onkeyup="filterTable()" />
  <table border="1" id="inventoryTable" style="margin-top: 20px;">
    <thead>
      <tr>
        <th>Year</th>
        <th>Make</th>
        <th>Model</th>
        <th>Retail</th>
        <th>Book</th>
        <th>Dealer Cost</th>
        <th>Days on Lot</th>
        <th>Times Matched</th>
      </tr>
    </thead>
    <tbody id="inventoryBody">
      <tr><td colspan="8">Loading...</td></tr>
    </tbody>
  </table>

  <script>
    const token = localStorage.getItem("access_token");

    if (!token) {
      alert("You're not logged in.");
      window.location.href = "/client/login";
    }

    async function loadInventory() {
      try {
        const res = await fetch("/inventory", {
          method: "GET",
          headers: {
            Authorization: "Bearer " + token
          }
        });

        if (!res.ok) throw new Error("Failed to load inventory");

        const data = await res.json();
        const body = document.getElementById("inventoryBody");
        body.innerHTML = "";

        for (const car of data) {
          body.innerHTML += `
            <tr>
              <td>${car.year || ''}</td>
              <td>${car.make || ''}</td>
              <td>${car.model || ''}</td>
              <td>${car.retail || ''}</td>
              <td>${car.book || ''}</td>
              <td>${car.dealer_cost || ''}</td>
              <td>${car.days_on_lot || ''}</td>
              <td>${car.times_matched || ''}</td>
            </tr>
          `;
        }
      } catch (err) {
        document.getElementById("inventoryBody").innerHTML = `<tr><td colspan="8">‚ùå ${err.message}</td></tr>`;
      }
    }

    function filterTable() {
      const search = document.getElementById("search").value.toLowerCase();
      const rows = document.querySelectorAll("#inventoryTable tbody tr");

      rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(search) ? "" : "none";
      });
    }

    loadInventory();
  </script>
</body>
</html>
